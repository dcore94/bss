var BSS={_get:function(n,i,t,e){return"function"==typeof n?n(i,t,e):n},polyfill:function(){var n="content"in document.createElement("template");if(!n){var i=Array.prototype.slice.call(document.getElementsByTagName("template"));for(var t in i){var e=i[t];for(content=e.children,fragment=document.createDocumentFragment(),e.style.display="none",j=0;node=content[j];j++)fragment.appendChild(node);e.content=fragment}}},commit:function(n){this._bindingCache.commit(n)},clear:function(n){this._bindingCache.clear(n);var i=document.querySelector(this.get(n.target));i.innerHTML=""},reapply:function(n){this._bindingCache.reapply(n)},apply:function(n){if(n.id||(n.id=1e12*Math.random()|0),this._bindingCache.clear(n),n.template){var i=this._get(n.template),t=document.querySelector(i);if(null==t)return void console.error("Template not found",i);var e=document.importNode(t.content,!0);this._bind(n,n,e),this.reapply(n);var r=this._get(n.target),a=document.querySelector(r);if(null==a)return void console.error("Target not found",r);a.parentNode.replaceChild(e,a)}else this._bind(n,n,document),this.reapply(n)},_bind:function(n,i,t,e,r,a){for(var o=t.querySelectorAll(this._get(n.target,t,e,a)),s=0;s<o.length;s++){var c=o.item(s),d=e,l=r;n.inout&&(d=l=this._get(n.inout,c,e,a)),n["in"]&&(d=this._get(n["in"],c,e,a)),n.out&&(l=this._get(n.out,c,e,a));var p=n.recurse?this._get(n.recurse,c,d,a):[],p=p?p instanceof Array?p:[p]:[];if(console.log("recurse is",p,"currentData",d),d instanceof Array){var u=[];for(var s in d)u.push(c.cloneNode(!0));var h=c.parentNode;h.removeChild(c);for(var m in u){var f=u[m];this._bindingCache.addApplyBinding(n,i,f,d,m),l&&this._bindingCache.addCommitBinding(n,i,f,l,m),this._registerEvents(n,f),h.appendChild(f);for(var g in p)this._bind(p[g],i,f,d[m],l?l[m]:null,m)}}else{this._bindingCache.addApplyBinding(n,i,c,d,null),l&&this._bindingCache.addCommitBinding(n,i,c,l,null),this._registerEvents(n,c);for(var g in p)this._bind(p[g],i,c,d,l,a)}}},_registerEvents:function(n,i){for(var t in n)if("on"==t){var e=n[t];for(var r in e){var a=e[r]instanceof Array?e[r]:[e[r]];a.forEach(function(n){i.addEventListener(r,n,!1)})}}else if(0==t.lastIndexOf("on_")){var a=n[t]instanceof Array?n[t]:[n[t]];a.forEach(function(n){i.addEventListener(t.substring(3),n,!1)})}},_bindingCache:{applies:{},commits:{},clear:function(n){this.applies[n.id]=this.applies[n.id]?this.applies[n.id].splice():[],this.commits[n.id]=this.commits[n.id]?this.commits[n.id].splice():[]},addApplyBinding:function(n,i,t,e,r){var a={element:t,index:r,transfer:n.apply?n.apply:function(){},data:r?e[r]:e,container:r?e:null};t.bss_input=a,this.applies[i.id].push(a)},addCommitBinding:function(n,i,t,e,r){var a={element:t,index:r,transfer:n.commit?n.commit:function(){},data:r?e[r]:e,container:r?e:null,remove:r?function(){this.container.splice(this.index,1)}:function(){}};t.bss_output=a,t.bss_binding=a,this.commits[i.id].push(a)},reapply:function(n){this.applies[n.id]&&this.applies[n.id].forEach(function(n){n.transfer(n.element,n.data,n.index)})},commit:function(n){this.commits[n.id]&&this.commits[n.id].forEach(function(n){n.transfer(n.element,n.data,n.index)})}}};
