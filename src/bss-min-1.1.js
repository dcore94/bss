function _BSS(){this._bindingCache=new _BindingCache}function _BindingCache(){this.applies={},this.commits={}}function _Binding(i,t,n,e,r){this.element=i,this.data=t,this.index=n,this.fun=e,r&&(this.container=r,this.element.bss_binding=this)}var BSS=new _BSS;_BSS.prototype._get=function(i,t,n,e){return"function"==typeof i?i(t,n,e):i},_BSS.prototype.commit=function(i){this._bindingCache.commit(i)},_BSS.prototype.clear=function(i){this._bindingCache.clear(i);var t=document.querySelector(this.get(i.target));t.innerHTML=""},_BSS.prototype.reapply=function(i){this._bindingCache.reapply(i)},_BSS.prototype.apply=function(i){if(i.id||(i.id=1e12*Math.random()|0),this._bindingCache.clear(i),i.template){var t=this._get(i.template),n=document.querySelector(t);if(null==n)return void console.error("Template not found",t);var e=document.importNode(n.content,!0);this._apply(i,i,e);var r=this._get(i.target),o=document.querySelector(r);if(null==o)return void console.error("Target not found",r);o.parentNode.replaceChild(e,o)}else this._apply(i,i,document)},_BSS.prototype._apply=function(i,t,n,e,r,o){for(var a=n.querySelectorAll(this._get(i.target,null,e,o)),s=i["in"]?this._get(i["in"],a,e,o):e,p=i.out?this._get(i.out,a,r,o):r,c=o,d=0;d<a.length;d++){var h=a.item(d);if(s instanceof Array){var l=[];for(var d in s)l.push(h.cloneNode(!0));var u=h.parentNode;u.removeChild(h);for(var m in l){var f=l[m],_=new _Binding(f,s[m],Number(m),i.apply);_.transfer(),this._bindingCache.addApplyBinding(t,_);var g=p instanceof Array?p[m]:p,_=new _Binding(f,g,Number(m),i.commit,p);if(this._bindingCache.addCommitBinding(t,_),u.appendChild(f),i.recurse)for(var y in i.recurse)this._apply(i.recurse[y],t,f,s[m],g,Number(m))}}else{var _=new _Binding(h,s,c,i.apply);_.transfer(),this._bindingCache.addApplyBinding(t,_);var _=new _Binding(h,p,c,i.commit);if(this._bindingCache.addCommitBinding(t,_),i.recurse)for(var y in i.recurse)this._apply(i.recurse[y],t,h,s,p,c)}}},_BindingCache.prototype.clear=function(i){this.applies[i.id]=this.applies[i.id]?this.applies[i.id].splice():[],this.commits[i.id]=this.commits[i.id]?this.commits[i.id].splice():[]},_BindingCache.prototype.addApplyBinding=function(i,t){this.applies[i.id].push(t)},_BindingCache.prototype.addCommitBinding=function(i,t){this.commits[i.id].push(t)},_BindingCache.prototype.reapply=function(i){this.applies[i.id]&&this.applies[i.id].forEach(function(i){i.transfer()})},_BindingCache.prototype.commit=function(i){this.commits[i.id]&&this.commits[i.id].forEach(function(i){i.transfer()})},_Binding.prototype.transfer=function(){this.fun&&this.fun(this.element,this.data,this.index)},_Binding.prototype.remove=function(){this.container.splice(this.index,1)};
