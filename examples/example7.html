<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"/>
		<title>Example 7: Injection</title>
		<style>
			div#TREE1_AREA{
				position: absolute;
				width: 50%;
			}
			div#TREE2_AREA{
				position: absolute;
				width: 50%;
				left: 50%;
			}
			ul.tree{ list-style: none;}
			li.treeitem.closed>ul.tree{ display: none; }
			li.treeitem { 
				list-style: none; 
				cursor: pointer;
			}
			li.treeitem>div[name=header]>span.title{
				font-weight: bold;
				font-size: 1.3em;
			}
			li.treeitem>div[name=header]>span.toggle:before{ 
				content : "\25BC";
				font-size: 0.6em;
				color: red;
			}
			li.treeitem.closed>div[name=header]>span.toggle:before{
				content : "\25BA";
				font-size: 0.6em;
				color: red;
			}
			footer{
				position:absolute;
				bottom:10%;
			}
		</style>
		<script type="text/javascript" src="../src/bss-min-1.2.2.js"></script>
		<script type="text/javascript">
			var tree_data = {
				children : [
					{
						root : "root1",
						children : [
							{ root : "root11",
								children : [ 
									{root : "root111"}
								]
							},
							{ root : "root12",
								children :[
									{ root : "root121", 
										children : [
											{ root : "root1211"},
											{ root : "root1212"},
										]
									}
								]
							},
							{ root : "root13" }
						]
					}
				]
			}
			
			var tree2_data = {
				classes : [
					{
						root : "Class1",
						objects : [
							{ root : "obj1",
								methods : [ 
									{root : "meth1"}
								]
							},
							{ root : "obj2",
								methods :[
									{ root : "meth2", 
										params : [
											{ root : "arg1" },
											{ root : "arg2" }
										]
									}
								]
							},
							{ root : "obj3"}
						]
					}
				]
			}
			
			var generated = {
				target : "li.treeitem",
				in : function(e,d,i){ return d.children ? d.children : [] },
				//clones ahead the current element into its children container. This is required in order to have when descending the data structure
				//the correpsonding UI elements to bind to since they are no longer statically defined in the template.
				apply : function(e,d,i){ var u = e.querySelector('ul.tree[name=children]'); u ? u.appendChild(e.cloneNode(true)) : undefined; },
				on_click: toggle,
				recurse : [
					{
						target: "div[name=header]>span.title",
						apply : function(e,d,i){ e.textContent = d.root; },
					},
					{
						target: "ul.tree[name=children]",
						recurse : function(e,d,i){ return generated }
					}
				]
			}

			var generated2 = {
				target : "li.treeitem",
				//binds to any of the possible types of children available at different levels
				in : function(e,d,i){ return (d.classes ? d.classes : (d.objects ? d.objects : ( d.methods ? d.methods : (d.params ? d.params : [])))) },
				apply : function(e,d,i){ var u = e.querySelector('ul.tree[name=children]'); u ? u.appendChild(e.cloneNode(true)) : null; },
				recurse : [
					{
						target: "div[name=header]>span.title",
						apply : function(e,d,i){ e.textContent = d.root; },
					},
					{
						target: "ul.tree[name=children]",
						recurse : function(e,d,i){ return generated2 }
					}
				]
			}

			function toggle(ev){
				ev.currentTarget.classList.toggle('closed')
				ev.stopPropagation()
			}

			var tree_bss = {
				template : "#TREE_TEMPLATE",
				target : "ul.tree1",
				in : tree_data,
				recurse : function(e,d,i){ return generated }
			}
			
			var tree2_bss = {
				template : "#TREE2_TEMPLATE",
				target : "ul.tree2",
				in : tree2_data,
				recurse : function(e,d,i){ return generated2 }
			}
		</script>
		<template id="TREE_TEMPLATE">
			<ul class="tree1">
				<li class="treeitem">
					<div name="header">
						<span class="toggle"></span>
						<span class="title">One header<span>
					</div>
					<div name="contents">
						<span>Some content ...</span>
					</div>
					<ul class="tree" name="children"></ul>
				</li>
			</ul>
		</template>
		<template id="TREE2_TEMPLATE">
			<ul class="tree2">
				<li class="treeitem">
					<div name="header">
						<span class="toggle"></span>
						<span class="title">One header<span>
					</div>
					<div name="contents">
						<span>Some content ...</span>
					</div>
					<ul class="tree" name="children"></ul>
				</li>
			</ul>
		</template>
	</head>
	<body>
		<h1>Example 7: Injection</h1>
		<p>
			Shows the use of injected BSS (look at generated1 and generate2) and cloned ahead UI elements (look at the apply function on li.treeitem)
			in order to face arbitrarily nested structures. 
			<br/>Injection is possible both with regular and irregular tree structures as show by the two different datastructures used for the two trees.
		</p>
		<hr/>
		<div id="TREE1_AREA">
			<ul class="tree1">
			</ul>
		</div>
		<div id="TREE2_AREA">
			<ul class="tree2">
			</ul>
		</div>
		<script type="text/javascript">
			BSS.polyfill() //in order to manage templates in older browsers and IE
			BSS.apply(tree_bss); 
			BSS.apply(tree2_bss);
		</script>
		
		<!-- License -->
		<footer>
			<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
				<img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
			</a><br/>
			<span>BSS Examples by Marco Lettere is licensed under a </span>
			<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
		</footer>
	</body>
</html>
